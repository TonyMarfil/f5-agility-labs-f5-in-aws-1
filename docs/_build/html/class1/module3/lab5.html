
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>2.3.5. Autoscale WAF &#8212; f5-agility-labs-f5-in-aws-1  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.3.6. Destroy environment" href="lab6.html" />
    <link rel="prev" title="2.3.4. Deploy an AWS High-Availability-aware virtual server across two Availability Zones" href="lab4.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="autoscale-waf">
<h1>2.3.5. Autoscale WAF<a class="headerlink" href="#autoscale-waf" title="Permalink to this headline">¶</a></h1>
<ol class="arabic simple">
<li>From the f5-super-netops container test out application behind the auto-scale waf is up. Replace the example https url with the one specific to your lab. See lab-info.</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -kI https://waf-user01f5io-499431932.us-east-1.elb.amazonaws.com
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>HTTP/1.1 <span class="m">200</span> OK
Accept-Ranges: bytes
Content-Type: text/html
Date: Sat, <span class="m">29</span> Jul <span class="m">2017</span> <span class="m">15</span>:50:12 GMT
Set-Cookie: <span class="nv">TS01e70004</span><span class="o">=</span>01eeb64b413ca1778c867b0174b4a4e8901d5361c37a2ef5634917272e2f6f9b77d14ed447d3903a5e45d1aeb723a0af78bd798f1a<span class="p">;</span> <span class="nv">Path</span><span class="o">=</span>/
X-COLOR: a0bf37
Connection: keep-alive
</pre></div>
</div>
<p>…The HTTP/1.1 200 OK status code is a sign that things went well. You can hit the example site behind the F5 WAF with a web browser.</p>
<a class="reference internal image-reference" href="../../_images/waf-example-site.png"><img alt="../../_images/waf-example-site.png" src="../../_images/waf-example-site.png" style="width: 735.0px; height: 653.0px;" /></a>
<ol class="arabic simple" start="2">
<li>Navigate to Services =&gt; AUTO SCALING =&gt; Auto Scaling Groups. Filter on your username and select your waf-userxx… auto scaling group.</li>
<li>Select the ‘Instances’ tab below, and select your Instance ID (there should be only one). If your instance is “Protected from… Scale in” then it will always stay up regardless of scale up/down thresholds configured. It’s common to keep a single minimum WAF instance running at all times and scale the 2nd, 3rd, Nth WAF during surges.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/autoscale-pending.png"><img alt="../../_images/autoscale-pending.png" src="../../_images/autoscale-pending.png" style="width: 855.5px; height: 329.5px;" /></a>
<ol class="arabic simple" start="4">
<li>Select the Scaling Polices tab. These policies were deployed via the CloudFormation template and can be changed via the CloudFormation template.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/autoscale-policy2.png"><img alt="../../_images/autoscale-policy2.png" src="../../_images/autoscale-policy2.png" style="width: 856.5px; height: 447.0px;" /></a>
<ol class="arabic simple" start="5">
<li>Login to the active BIG-IP Autoscale Instance MGMT IP <strong>on port 8443</strong> configuration utility (web ui). Using the examples in our lab-info output in earlier tasks: <a class="reference external" href="https://52.207.200.169:8443">https://52.207.200.169:8443</a></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lab-info
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li>In the Big-IP Configuration utility (Web UI) navigate to Security -&gt; Application Security -&gt; Security Policies -&gt; Active Polices. A “linux-low” policy was deployed via CloudFormation template and is in Enforcment Mode: Blocking.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/waf-policy.png"><img alt="../../_images/waf-policy.png" src="../../_images/waf-policy.png" style="width: 857.5px; height: 397.5px;" /></a>
<ol class="arabic simple" start="7">
<li>From the f5-super-netops container, let’s launch some traffic against the application behind our WAF and watch it autoscale to service the surge! Replace the <a class="reference external" href="https://waf-userxx">https://waf-userxx</a>… in the command below with the one in the output of lab-info and don’t miss that critical forward slash / at the end!</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>base64 /dev/urandom <span class="p">|</span> head -c <span class="m">3000</span> &gt; payload
ab -t <span class="m">120</span> -c <span class="m">200</span> -c <span class="m">5</span> -T <span class="s1">&#39;multipart/form-data; boundary=1234567890&#39;</span> -p payload https://waf-user11f5democom-xxxxxxxxx.us-east-1.elb.amazonaws.com/
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li>Services =&gt; Compute =&gt; EC2 =&gt; INSTANCES =&gt; Instances. Filter on your username and after 60 seconds (the lowest configurable time threshold) hit refresh to see your 2nd autoscale WAF instance starting.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/autoscale-initializing.png"><img alt="../../_images/autoscale-initializing.png" src="../../_images/autoscale-initializing.png" style="width: 852.5px; height: 258.5px;" /></a>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../class1.html">2. Class - |classname|</a><ul>
  <li><a href="module3.html">2.3. Extending and Securing your Cloud</a><ul>
      <li>Previous: <a href="lab4.html" title="previous chapter">2.3.4. Deploy an AWS High-Availability-aware virtual server across two Availability Zones</a></li>
      <li>Next: <a href="lab6.html" title="next chapter">2.3.6. Destroy environment</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/class1/module3/lab5.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Tony Marfil.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="../../_sources/class1/module3/lab5.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>